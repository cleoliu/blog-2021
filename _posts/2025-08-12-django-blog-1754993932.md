---
title: 從零開始使用 Django 建立一個部落格系統並加入評論功能
date: 2025-08-12 18:43:21 +0800
categories: [Django, Web Development, Tutorial]
tags: [Python, Blog, CMS, ORM, MVC, Comments]
image: /assets/images/django-blog-banner.jpg
description: 本教學文章將帶領您從頭開始，使用 Django 框架逐步建立一個功能完整的部落格系統，並詳細說明如何加入文章評論功能。
---

## 導言

在當今資訊爆炸的時代，部落格系統仍是個人分享知識、經驗，或企業進行內容行銷的重要工具。Django 作為一個高階的 Python Web 框架，以其「快速開發」和「DRY (Don't Repeat Yourself)」原則而聞名，非常適合用來建立功能豐富的網站應用程式。

本教學文章旨在手把手引導您，從零開始使用 Django 框架建立一個基本的部落格系統。我們不僅會涵蓋文章的建立、顯示與後台管理，更將深入探討如何為您的部落格文章添加互動性極高的評論功能。透過本教學，您將對 Django 的模型（Models）、視圖（Views）、模板（Templates）和 URL 配置有更深入的理解，並能獨立開發更複雜的 Web 應用。

## 前置需求

在開始實作之前，請確保您的開發環境已具備以下條件：

*   **Python 3.8 或更高版本**: Django 需要 Python 環境來運行。
*   **pip**: Python 的套件安裝工具，通常隨 Python 一同安裝。
*   **虛擬環境 (Virtual Environment)**: 強烈建議使用虛擬環境來管理專案的依賴，避免不同專案間的套件衝突。
*   **基礎的 Python 語法知識**: 對 Python 變數、函式、類別等有基本認識。
*   **基礎的 HTML 知識**: 對 HTML 標籤和結構有基本了解。

### 安裝 Django

首先，打開您的終端機或命令提示字元，建立並啟用一個虛擬環境，然後安裝 Django：

```bash
# 建立虛擬環境 (如果尚未建立)
python -m venv venv

# 啟用虛擬環境
# Windows
.\venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# 安裝 Django
pip install django
```text
## 實作步驟

接下來，我們將分步建立部落格的核心功能，然後再添加評論功能。

### 步驟一：建立 Django 專案

使用 `django-admin` 命令來建立一個新的 Django 專案。這將生成專案所需的基礎檔案結構。

```bash
# 確保您在希望建立專案的目錄中
django-admin startproject myblog
```text
進入新建立的專案目錄：

```bash
cd myblog
```text
### 步驟二：建立 Blog 應用程式

在 Django 中，一個專案可以包含多個應用程式（App），每個 App 負責一個特定功能模組。我們將建立一個 `blog` App 來管理部落格的相關功能。

```bash
python manage.py startapp blog
```text
建立 App 後，**務必**將其註冊到專案的 `INSTALLED_APPS` 中。打開 `myblog/settings.py` 檔案，找到 `INSTALLED_APPS` 列表並添加 `'blog'`：

```python
# myblog/settings.py

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'blog',  # 添加你的 blog 應用程式
]
```text
### 步驟三：設計文章模型 (Post Model)

模型是 Django 中定義資料庫結構的方式。我們需要在 `blog/models.py` 中定義 `Post` 模型，包含文章的標題、內容、作者和發佈時間。

```python
# blog/models.py
from django.db import models
from django.contrib.auth.models import User # 導入 Django 內建的 User 模型

class Post(models.Model):
    title = models.CharField(max_length=200, verbose_name="標題")
    content = models.TextField(verbose_name="內容")
    author = models.ForeignKey(User, on_delete=models.CASCADE, verbose_name="作者")
    published_date = models.DateTimeField(auto_now_add=True, verbose_name="發佈時間")

    class Meta:
        ordering = ['-published_date'] # 依照發佈時間倒序排列

    def __str__(self):
        return self.title
```text
### 步驟四：執行資料庫遷移

定義模型後，需要將模型的變更應用到資料庫中。

```bash
python manage.py makemigrations
python manage.py migrate
```text
*   `makemigrations`: 根據你 `models.py` 的變化生成遷移文件。
*   `migrate`: 執行這些遷移，實際創建或修改資料庫表。

### 步驟五：建立文章視圖 (Views)

視圖負責處理 HTTP 請求並返回響應，通常是渲染 HTML 模板。我們將建立一個文章列表頁和一個文章詳細頁的視圖。

```python
# blog/views.py
from django.shortcuts import render, get_object_or_404
from django.views.generic import ListView, DetailView # 引入通用視圖
from .models import Post

class PostListView(ListView):
    model = Post
    template_name = 'blog/post_list.html' # 指定模板文件
    context_object_name = 'posts' # 在模板中使用的變數名
    paginate_by = 10 # 每頁顯示的文章數量 (可選)

class PostDetailView(DetailView):
    model = Post
    template_name = 'blog/post_detail.html'
    context_object_name = 'post' # 在模板中使用的變數名
```text
### 步驟六：設定 URL 路由

URL 路由將 URL 模式映射到相應的視圖。我們需要在專案級別和應用程式級別設定 URL。

首先，在 `myblog/urls.py` 中包含 `blog` 應用程式的 URL：

```python
# myblog/urls.py
from django.contrib import admin
from django.urls import path, include # 導入 include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('blog/', include('blog.urls')), # 包含 blog 應用程式的 URL
]
```text
接下來，在 `blog` 應用程式中創建一個 `urls.py` 文件，並定義文章列表和詳細頁的路由：

```python
# blog/urls.py (新建此檔案)
from django.urls import path
from .views import PostListView, PostDetailView

app_name = 'blog' # 定義應用程式命名空間

urlpatterns = [
    path('', PostListView.as_view(), name='post_list'),
    path('<int:pk>/', PostDetailView.as_view(), name='post_detail'), # <int:pk> 用於匹配文章 ID
]
```text
### 步驟七：建立模板

模板是定義網站前端 HTML 結構的地方。我們需要為文章列表和詳細頁面創建模板。

首先，在 `blog` 目錄下創建 `templates/blog/` 子目錄：

```text
myblog/
├── blog/
│   ├── templates/
│   │   └── blog/
│   │       ├── post_list.html
│   │       └── post_detail.html
│   ├── ...
├── myblog/
├── manage.py
└── ...
```text
**`blog/templates/blog/post_list.html`**:

```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的部落格</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .post { border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .post h2 { margin-top: 0; }
        .post-meta { font-size: 0.9em; color: #666; }
        a { text-decoration: none; color: #007bff; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>最新文章</h1>
    `{% for post in posts  %}`
        <div class="post">
            <h2><a href="`[Django URL pattern]`">`{{ post.title  }}`</a></h2>
            <p class="post-meta">
                作者: `{{ post.author.username  }}` | 發佈日期: `{{ post.published_date|date:"Y年m月d日"  }}`
            </p>
            <p>`{{ post.content|truncatechars:200  }}`</p> {# 顯示部分內容 #}
        </div>
    `{% empty  %}`
        <p>目前沒有文章。</p>
    `{% endfor  %}`
</body>
</html>
```text
**`blog/templates/blog/post_detail.html`**:

```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`{{ post.title  }}` - 我的部落格</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        h1 { margin-top: 0; }
        .post-meta { font-size: 0.9em; color: #666; margin-bottom: 20px; }
        .post-content { line-height: 1.6; }
        .back-link { margin-top: 30px; display: block; }
        a { text-decoration: none; color: #007bff; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>`{{ post.title  }}`</h1>
    <p class="post-meta">
        作者: `{{ post.author.username  }}` | 發佈日期: `{{ post.published_date|date:"Y年m月d日 H:i"  }}`
    </p>
    <div class="post-content">
        `{{ post.content|linebreaksbr  }}` {# 顯示完整內容，並處理換行 #}
    </div>

    <a href="`[Django URL pattern]`" class="back-link">返回文章列表</a>
</body>
</html>
```text
### 步驟八：設定後台管理

Django 提供了一個強大的自動化管理介面。為了能方便地新增和管理文章，我們需要將 `Post` 模型註冊到管理介面。

```python
# blog/admin.py
from django.contrib import admin
from .models import Post

admin.site.register(Post)
```text
**建立超級使用者**：
為了登入後台，您需要建立一個超級使用者：

```bash
python manage.py createsuperuser
```text
按照提示輸入用戶名、電子郵件（可選）和密碼。

### 步驟九：啟動開發伺服器

現在，您可以啟動 Django 開發伺服器，並在瀏覽器中查看您的部落格了！

```bash
python manage.py runserver
```text
打開瀏覽器，訪問 `http://127.0.0.1:8000/blog/` 查看文章列表。
訪問 `http://127.0.0.1:8000/admin/` 登入後台，您就可以新增文章了。

---

## 加入評論功能

部落格的互動性很大程度上取決於其評論功能。現在，我們將為文章添加評論模組。

### 步驟十：建立評論模型 (Comment Model)

在 `blog/models.py` 中添加 `Comment` 模型，它將包含評論內容、評論者、以及評論所屬的文章。

```python
# blog/models.py (新增以下內容)
from django.db import models
from django.contrib.auth.models import User

# ... (Post 模型在上面已經定義)

class Comment(models.Model):
    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name='comments', verbose_name="所屬文章")
    name = models.CharField(max_length=80, verbose_name="姓名")
    email = models.EmailField(verbose_name="電子郵件", blank=True, null=True)
    body = models.TextField(verbose_name="評論內容")
    created_on = models.DateTimeField(auto_now_add=True, verbose_name="評論時間")
    active = models.BooleanField(default=False) # 預設評論需要審核

    class Meta:
        ordering = ['created_on']

    def __str__(self):
        return f'評論 by {self.name} on {self.post}'
```text
### 步驟十一：再次執行資料庫遷移

新的模型需要再次應用到資料庫：

```bash
python manage.py makemigrations
python manage.py migrate
```text
### 步驟十二：建立評論表單

使用 Django 的 `forms` 模組來建立一個用於提交評論的表單。在 `blog` 目錄下創建一個新檔案 `forms.py`：

```python
# blog/forms.py (新建此檔案)
from django import forms
from .models import Comment

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        fields = ('name', 'email', 'body')
        widgets = {
            'name': forms.TextInput(attrs={'placeholder': '您的姓名'}),
            'email': forms.EmailInput(attrs={'placeholder': '您的電子郵件 (選填)'}),
            'body': forms.Textarea(attrs={'placeholder': '輸入您的評論...', 'rows': 4}),
        }
        labels = {
            'name': '',
            'email': '',
            'body': '',
        }
```text
### 步驟十三：修改文章詳細頁面視圖

需要修改 `PostDetailView`，使其能夠顯示現有評論，並處理新評論的提交。
由於 `DetailView` 處理單個對象較為簡單，對於表單處理，我們改用函式型視圖或者自定義 `get_context_data` 方法。這裡我們示範使用函式型視圖，以便於處理 `POST` 請求。

```python
# blog/views.py
from django.shortcuts import render, get_object_or_404, redirect # 導入 redirect
from django.views.generic import ListView # 移除 DetailView 的 import
from .models import Post, Comment # 導入 Comment
from .forms import CommentForm # 導入 CommentForm

# 文章列表視圖 (不變)
class PostListView(ListView):
    model = Post
    template_name = 'blog/post_list.html'
    context_object_name = 'posts'
    paginate_by = 10

# 將 PostDetailView 轉換為函式型視圖，以便處理評論表單
def post_detail(request, pk):
    post = get_object_or_404(Post, pk=pk)
    comments = post.comments.filter(active=True) # 只顯示已審核的評論
    new_comment = None

    if request.method == 'POST':
        comment_form = CommentForm(data=request.POST)
        if comment_form.is_valid():
            # 建立但還不儲存評論實例
            new_comment = comment_form.save(commit=False)
            # 將評論與當前文章關聯
            new_comment.post = post
            # 儲存評論到資料庫 (active 預設為 False，需要管理員審核)
            new_comment.save()
            return redirect('blog:post_detail', pk=post.pk) # 提交成功後重導向以避免重複提交
    else:
        comment_form = CommentForm()

    return render(request, 'blog/post_detail.html', {
        'post': post,
        'comments': comments,
        'comment_form': comment_form,
        'new_comment': new_comment,
    })
```text
**修改 `blog/urls.py` 以使用新的 `post_detail` 函式型視圖：**

```python
# blog/urls.py
from django.urls import path
from .views import PostListView, post_detail # 引用新的 post_detail 視圖

app_name = 'blog'

urlpatterns = [
    path('', PostListView.as_view(), name='post_list'),
    path('<int:pk>/', post_detail, name='post_detail'), # 修改為函式型視圖
]
```text
### 步驟十四：更新文章詳細頁面模板

修改 `blog/templates/blog/post_detail.html`，以顯示評論並包含評論表單。

```html
<!-- blog/templates/blog/post_detail.html (修改以下內容) -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`{{ post.title  }}` - 我的部落格</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        h1 { margin-top: 0; }
        .post-meta { font-size: 0.9em; color: #666; margin-bottom: 20px; }
        .post-content { line-height: 1.6; }
        .back-link { margin-top: 30px; display: block; }
        a { text-decoration: none; color: #007bff; }
        a:hover { text-decoration: underline; }

        /* 評論樣式 */
        .comments-section { margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px; }
        .comment { background-color: #f9f9f9; border: 1px solid #eee; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .comment-meta { font-size: 0.85em; color: #777; margin-bottom: 5px; }
        .comment-body { margin-top: 10px; }
        .comment-form input[type="text"],
        .comment-form input[type="email"],
        .comment-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; /* Ensures padding doesn't increase total width */
        }
        .comment-form button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        .comment-form button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>`{{ post.title  }}`</h1>
    <p class="post-meta">
        作者: `{{ post.author.username  }}` | 發佈日期: `{{ post.published_date|date:"Y年m月d日 H:i"  }}`
    </p>
    <div class="post-content">
        `{{ post.content|linebreaksbr  }}`
    </div>

    <div class="comments-section">
        <h3>評論 (`{{ comments.count  }}`)</h3>
        `{% if comments  %}`
            `{% for comment in comments  %}`
                <div class="comment">
                    <p class="comment-meta">
                        <strong>`{{ comment.name  }}`</strong> 於 `{{ comment.created_on|date:"Y年m月d日 H:i"  }}` 留言
                    </p>
                    <div class="comment-body">
                        `{{ comment.body|linebreaksbr  }}`
                    </div>
                </div>
            `{% endfor  %}`
        `{% else  %}`
            <p>目前沒有評論。</p>
        `{% endif  %}`

        `{% if new_comment  %}`
            <p style="color: green;">您的評論已成功提交，等待管理員審核。</p>
        `{% else  %}`
            <h4>發表評論</h4>
            <form action="`[Django URL pattern]`" method="post" class="comment-form">
                `{% csrf_token  %}` {# 這是 Django 安全機制，必須添加 #}
                `{{ comment_form.as_p  }}` {# 使用 as_p 快速渲染表單 #}
                <button type="submit">提交評論</button>
            </form>
        `{% endif  %}`
    </div>

    <a href="`[Django URL pattern]`" class="back-link">返回文章列表</a>
</body>
</html>
```text
### 步驟十五：註冊評論模型到後台

為了能在 Django 管理介面中審核和管理評論，將 `Comment` 模型註冊到 `admin.py`：

```python
# blog/admin.py
from django.contrib import admin
from .models import Post, Comment # 導入 Comment

admin.site.register(Post)

@admin.register(Comment) # 使用 decorator 方式註冊並添加自定義選項
class CommentAdmin(admin.ModelAdmin):
    list_display = ('name', 'email', 'post', 'created_on', 'active')
    list_filter = ('active', 'created_on')
    search_fields = ('name', 'email', 'body')
    actions = ['approve_comments']

    def approve_comments(self, request, queryset):
        queryset.update(active=True)
    approve_comments.short_description = "批准選定的評論"
```text
重新啟動開發伺服器，訪問文章詳細頁面，您現在應該可以看到評論區和提交表單了。提交評論後，需要登入管理後台 (`/admin/`)，在 `Comments` 列表中將 `active` 狀態設為 `True` 才能顯示在前端。

## 常見錯誤與解法

1.  **`ModuleNotFoundError: No module named 'django'`**
    *   **原因**: Django 尚未安裝或虛擬環境未正確啟用。
    *   **解法**: 確保您已啟用虛擬環境並執行 `pip install django`。

2.  **`django.db.utils.OperationalError: no such table: blog_post`** 或 **`Column not found`**
    *   **原因**: 資料庫遷移未執行或未正確應用。
    *   **解法**: 確保您在專案根目錄下運行了 `python manage.py makemigrations` 和 `python manage.py migrate`。如果之前有資料，可能需要刪除 `db.sqlite3` 檔案並重新執行遷移（僅限開發環境）。

3.  **`TemplateDoesNotExist at /blog/`**
    *   **原因**: Django 無法找到您指定的模板檔案。
    *   **解法**:
        *   檢查 `templates` 目錄結構是否正確（例如：`blog/templates/blog/post_list.html`）。
        *   確認 `settings.py` 中的 `TEMPLATES` 配置是否指向了正確的目錄（預設情況下，`DIRS` 為空，它會自動尋找 App 內部的 `templates` 資料夾）。
        *   確保模板檔案名與 `views.py` 中 `template_name` 完全匹配。

4.  **`Reverse for 'post_detail' with arguments '('',)' not found. 1 pattern tried: 'blog/(?P<pk>[0-9]+)/'`**
    *   **原因**: 在模板中生成 URL 時，傳遞給 `url` 標籤的參數不正確或缺少。
    *   **解法**: 檢查 ``[Django URL pattern]``，確保 `pk` 值存在且傳遞正確。

5.  **`CSRF verification failed. Request aborted.`**
    *   **原因**: 表單提交時缺少 Django 的 CSRF 保護令牌。
    *   **解法**: 在所有 `POST` 請求的 HTML `<form>` 標籤內部添加 ``{% csrf_token  %}``。

6.  **Admin 介面看不到模型**
    *   **原因**: 模型未在 `admin.py` 中註冊。
    *   **解法**: 確保在 `blog/admin.py` 中有 `admin.site.register(YourModelName)`。

## 延伸應用與學習資源

恭喜您！您已經成功建立了一個基本的 Django 部落格系統，並添加了評論功能。這只是 Django 強大功能的冰山一角。您可以繼續探索以下進階功能來豐富您的部落格：

*   **使用者認證與權限**: 允許用戶註冊、登入，並管理不同用戶組的權限（例如，只有登入用戶才能發文或評論）。
*   **富文本編輯器 (Rich Text Editor)**: 整合如 TinyMCE 或 CKEditor 等編輯器，讓文章內容可以包含圖片、格式化文本等。
*   **文章分頁**: 當文章數量很多時，實現分頁功能，提高載入速度和用戶體驗。
*   **搜尋功能**: 允許用戶搜尋文章內容或標題。
*   **標籤 (Tags) 功能**: 為文章添加標籤，方便內容分類和查找。
*   **部署**: 將您的 Django 應用程式部署到實際的伺服器上，如 Heroku, Vercel, AWS 或 GCP。
*   **第三方套件**: 探索 Django 生態系統中豐富的第三方套件，例如用於圖像處理的 `Pillow`，或用於 API 開發的 `Django REST Framework`。

### 推薦學習資源：

*   **Django 官方文檔 (Django Official Documentation)**: 最權威、最詳細的學習資料。
    *   [https://docs.djangoproject.com/](https://docs.djangoproject.com/)
*   **Django Girls 教學 (Django Girls Tutorial)**: 非常適合初學者，以建立部落格為例，逐步引導。
    *   [https://tutorial.djangogirls.org/zh/](https://tutorial.djangogirls.org/zh/)
*   **MDN Web Docs - Django Web 框架 (Django Web Framework)**: 提供清晰的入門指南。
    *   [https://developer.mozilla.org/zh-TW/docs/Learn/Server-side/Django](https://developer.mozilla.org/zh-TW/docs/Learn/Server-side/Django)

希望這篇文章能幫助您邁出 Django 學習的第一步！祝您開發愉快！