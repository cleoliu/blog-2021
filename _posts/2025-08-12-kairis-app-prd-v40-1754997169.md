---
layout: post
title: "Kairis App - 產品需求文件 (PRD) v4.0 (最終版)"
date: 2025-08-12 19:12:49 +0800
categories: []
tags: []
description: "Kairis App - 產品需求文件 (PRD) v4.0 (最終版)"

---

好的，這是一篇將您的需求轉化為完整教學文章的 Markdown 格式內容，遵循您所有的要求。

```markdown
---
title: "使用 Django 和 JavaScript 建立即時股價顯示應用程式"
date: 2025-08-13 10:29:57 +0800
categories:
  - Web Development
  - Django
  - Python
tags:
  - real-time
  - stock-price
  - JavaScript
  - AJAX
  - frontend
  - backend
description: "本教學文章將引導您如何使用 Django 建立後端 API 並透過 JavaScript 實現前端的動態資料更新，從而打造一個基本的即時股價顯示應用程式。透過 AJAX 定時請求，我們將模擬股票價格的即時變動。"
---

## 導言

在當今快節奏的數位世界中，即時資料的呈現至關重要，尤其是在金融市場。想像一下，如果您能擁有一個應用程式，能夠即時顯示股票的最新價格，而無需手動刷新頁面，那將會是多麼便捷！

本教學文章的目標是引導您從零開始，使用 Python 的 Django 框架作為後端，並結合前端的 HTML、CSS 和 JavaScript，建立一個簡單但功能完善的即時股價顯示應用程式。雖然我們將使用模擬數據來簡化教學，但其核心原理可應用於實際的股票數據 API。我們將透過 AJAX (Asynchronous JavaScript and XML) 技術實現資料的定期更新，從而達到「即時」顯示的效果。

## 前置需求

在開始實作之前，請確保您的開發環境已具備以下工具和基礎知識：

*   **Python 3.8 或更高版本**：Django 依賴 Python 運行。
*   **pip (Python 包管理器)**：通常隨 Python 安裝。
*   **虛擬環境 (Virtual Environment)**：推薦用於隔離專案依賴。
*   **基本的 Django 知識**：了解如何建立專案、應用程式、視圖 (Views) 和 URL 配置。
*   **基本的 HTML/CSS 知識**：用於構建網頁佈局。
*   **基本的 JavaScript 知識**：用於前端資料請求和 DOM 操作。

## 實作步驟

我們將逐步建立這個應用程式，從 Django 專案的初始化到前端 JavaScript 的實作。

### 步驟 1 - 建立 Django 專案與應用程式

首先，讓我們建立一個 Django 專案和一個名為 `core` 的應用程式來存放我們的邏輯。

1.  **建立專案目錄並進入：**

    ```bash
    mkdir stock_app
    cd stock_app
    ```text
2.  **建立並啟用虛擬環境：**

    ```bash
    python -m venv venv
    # macOS/Linux
    source venv/bin/activate
    # Windows
    venv\Scripts\activate
    ```text
3.  **安裝 Django 和 Django REST Framework (DRF)：**
    雖然我們不完全使用 DRF 的序列化功能，但它的 `APIView` 和 `JsonResponse` 在構建 API 時非常方便。

    ```bash
    pip install Django djangorestframework
    ```text
4.  **建立 Django 專案和應用程式：**

    ```bash
    django-admin startproject stock_viewer .
    python manage.py startapp core
    ```text
### 步驟 2 - 配置 Django 專案

接下來，我們需要告訴 Django 專案關於我們新建立的 `core` 應用程式和靜態檔案 (Static Files) 的位置。

1.  **編輯 `stock_viewer/settings.py` 檔案：**
    找到 `INSTALLED_APPS` 列表，加入 `'core'` 和 `'rest_framework'`。同時，我們需要配置靜態檔案的目錄，以便前端的 JavaScript 和 CSS 檔案能夠被 Django 找到。

    ```python
    # stock_viewer/settings.py

    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'core', # 加入你的應用程式
        'rest_framework', # 加入 DRF
    ]

    # ... 其他設定 ...

    # 在檔案的末尾或其他合適的位置添加靜態檔案設定
    import os

    STATIC_URL = '/static/'
    STATICFILES_DIRS = [
        os.path.join(BASE_DIR, 'static'),
    ]

    # ... 其他設定 ...
    ```text
### 步驟 3 - 定義 API 邏輯

我們將在 `core` 應用程式中建立一個視圖 (View)，它將模擬返回股票價格的 API。

1.  **編輯 `core/views.py` 檔案：**
    這個視圖會接收一個股票代號 (symbol)，並返回一個隨機生成的模擬價格。

    ```python
    # core/views.py

    from django.http import JsonResponse
    import random

    def get_stock_price(request, symbol):
        """
        模擬獲取股票價格的 API 視圖。
        在實際應用中，這裡會調用第三方股票數據 API。
        """
        if request.method == 'GET':
            # 這裡我們生成一個隨機價格來模擬數據變動
            # 實際應用中，你會從外部 API 獲取真實數據
            try:
                # 簡單的哈希函數，讓不同股票代號有不同的初始隨機範圍
                # 確保價格看起來「變化」
                seed_val = sum(ord(c) for c in symbol.upper())
                random.seed(seed_val)
                # 生成一個在合理範圍內的隨機浮點數
                price = round(random.uniform(100.0, 2000.0), 2)
                # 模擬價格波動，每次調用微調
                price += round(random.uniform(-5.0, 5.0), 2)
                if price < 1.0: # 確保價格不為負或過低
                    price = 1.0

                return JsonResponse({'symbol': symbol.upper(), 'price': price})
            except Exception as e:
                return JsonResponse({'error': f'Invalid symbol or processing error: {e}'}, status=400)
        return JsonResponse({'error': 'Only GET requests are allowed.'}, status=405)

    ```text
### 步驟 4 - 配置 URL 路由

現在，我們需要為 `get_stock_price` 視圖建立一個 URL 路徑，以便前端可以訪問它。

1.  **在 `core` 應用程式中建立 `urls.py` 檔案：**

    ```python
    # core/urls.py

    from django.urls import path
    from . import views

    urlpatterns = [
        path('api/price/<str:symbol>/', views.get_stock_price, name='get_stock_price'),
    ]
    ```text
2.  **編輯專案的 `stock_viewer/urls.py` 檔案：**
    將 `core` 應用程式的 URL 包含進來。

    ```python
    # stock_viewer/urls.py

    from django.contrib import admin
    from django.urls import path, include
    from django.views.generic import TemplateView # 用於簡單的 HTML 頁面

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('api/', include('core.urls')), # 包含 core 應用程式的 API URL
        # 為了方便，我們直接提供一個首頁模板
        path('', TemplateView.as_view(template_name='core/index.html'), name='home'),
    ]
    ```text
### 步驟 5 - 建立前端頁面

我們需要一個 HTML 頁面來顯示股票價格，並包含我們的 JavaScript 邏輯。

1.  **在 `core` 應用程式中建立 `templates/core/` 目錄：**

    ```bash
    mkdir -p core/templates/core
    ```text
2.  **建立 `core/templates/core/index.html` 檔案：**

    ```html
    <!-- core/templates/core/index.html -->
    `{% load static  %}`
    <!DOCTYPE html>
    <html lang="zh-Hant">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>即時股價檢視器</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                background-color: #f4f4f4;
                margin: 0;
            }
            .container {
                background-color: #fff;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                text-align: center;
            }
            h1 {
                color: #333;
                margin-bottom: 20px;
            }
            .price-display {
                font-size: 2.5em;
                font-weight: bold;
                color: #28a745; /* Green for positive change */
            }
            .symbol {
                font-size: 1.2em;
                color: #666;
                margin-bottom: 15px;
            }
            .last-updated {
                font-size: 0.9em;
                color: #999;
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>即時股價檢視器</h1>
            <div class="symbol">股票代號：<span id="stockSymbol">AAPL</span></div>
            <div class="price-display">
                最新價格：$<span id="price">--.--</span>
            </div>
            <div class="last-updated">
                上次更新時間：<span id="lastUpdated">N/A</span>
            </div>
        </div>

        <!-- 引入 JavaScript 檔案 -->
        <script src="`{% static 'js/main.js'  %}`"></script>
    </body>
    </html>
    ```text
### 步驟 6 - 編寫 JavaScript 邏輯

這是前端的核心，它將定期向 Django 後端發送請求，獲取最新的股票價格並更新頁面。

1.  **在專案根目錄下建立 `static/js/` 目錄：**

    ```bash
    mkdir -p static/js
    ```text
2.  **建立 `static/js/main.js` 檔案：**

    ```javascript
    // static/js/main.js

    document.addEventListener('DOMContentLoaded', function() {
        const stockSymbol = document.getElementById('stockSymbol').innerText; // 從 HTML 獲取股票代號
        const priceElement = document.getElementById('price');
        const lastUpdatedElement = document.getElementById('lastUpdated');

        function fetchPrice() {
            // 使用 Fetch API 請求後端 API
            fetch(`/api/price/${stockSymbol}/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.price) {
                        priceElement.innerText = data.price.toFixed(2); // 顯示兩位小數
                        lastUpdatedElement.innerText = new Date().toLocaleTimeString(); // 更新時間
                        console.log(`Updated price for ${data.symbol}: $${data.price}`);
                    } else if (data.error) {
                        console.error('API Error:', data.error);
                        priceElement.innerText = '錯誤';
                    }
                })
                .catch(error => {
                    console.error('Error fetching stock price:', error);
                    priceElement.innerText = '載入失敗';
                });
        }

        // 頁面載入時立即獲取一次價格
        fetchPrice();

        // 每 5 秒獲取一次價格 (模擬即時更新)
        setInterval(fetchPrice, 5000); // 5000 毫秒 = 5 秒
    });
    ```text
### 步驟 7 - 運行應用程式

現在，我們已經完成了所有的程式碼，是時候運行應用程式並查看成果了。

1.  **收集靜態檔案 (Collect Static Files)：**
    這一步是必須的，它會將 `static` 目錄下的靜態檔案複製到 Django 預期的位置。

    ```bash
    python manage.py collectstatic
    ```text
    當它詢問你是否確定時，輸入 `yes`。

2.  **運行 Django 開發伺服器：**

    ```bash
    python manage.py runserver
    ```text
3.  **打開瀏覽器：**
    訪問 `http://127.0.0.1:8000/`。您應該會看到一個顯示股票代號和價格的頁面，價格每隔 5 秒會自動更新。

## 常見錯誤與解法

在實作過程中，您可能會遇到以下一些常見問題：

1.  **`ModuleNotFoundError: No module named 'django'` 或 `'rest_framework'`**
    *   **原因**：Django 或 Django REST Framework 尚未安裝，或者您沒有在虛擬環境中安裝。
    *   **解法**：確保您已啟用虛擬環境，然後運行 `pip install Django djangorestframework`。

2.  **`TemplateDoesNotExist at /`**
    *   **原因**：Django 無法找到您指定的 HTML 模板檔案。
    *   **解法**：
        *   檢查 `stock_viewer/settings.py` 中的 `TEMPLATES` 設定，特別是 `DIRS` 部分，確保它包含您的模板目錄（在我們的情況下，通常會自動找到應用程式內的 `templates` 目錄）。
        *   檢查 `core/templates/core/index.html` 的路徑是否正確，確保目錄結構與程式碼中匹配 (`core/templates/core/index.html`)。

3.  **靜態檔案 (JavaScript/CSS) 未載入**
    *   **原因**：瀏覽器控制台會顯示 404 錯誤，因為它找不到 `main.js`。
    *   **解法**：
        *   確認 `stock_viewer/settings.py` 中 `STATIC_URL` 和 `STATICFILES_DIRS` 配置正確。
        *   運行 `python manage.py collectstatic`。在開發環境中，Django 會在您運行 `runserver` 時自動處理靜態檔案，但 `collectstatic` 是一個好習慣，在部署時也是必要的。
        *   檢查 `index.html` 中 ``{% static 'js/main.js'  %}`` 語法是否正確，並且 `main.js` 確實位於 `static/js/` 目錄下。
        *   確保 ``{% load static  %}`` 在模板檔案的頂部。

4.  **API 調用失敗 (瀏覽器控制台顯示網絡錯誤或 404)**
    *   **原因**：JavaScript `fetch` 請求的 URL 不正確，或後端 API 路由未正確配置。
    *   **解法**：
        *   檢查 `stock_viewer/urls.py` 和 `core/urls.py` 中的 URL 配置，確保路徑與您在 JavaScript 中請求的 `/api/price/<symbol>/` 相符。
        *   檢查 `core/views.py` 中 `get_stock_price` 視圖的邏輯是否有錯誤。
        *   使用瀏覽器的開發者工具 (Developer Tools) 中的 "Network" 選項卡，檢查 API 請求的狀態碼和響應內容。

5.  **價格沒有更新**
    *   **原因**：JavaScript 程式碼有錯誤，`setInterval` 未正確執行，或 `fetch` 請求成功但資料處理有誤。
    *   **解法**：
        *   打開瀏覽器開發者工具的 "Console" 選項卡，檢查是否有 JavaScript 錯誤訊息。
        *   在 `fetchPrice` 函數中添加 `console.log()` 語句，逐步檢查資料 (`response`, `data`) 是否如預期。
        *   確認 `setInterval(fetchPrice, 5000);` 確實被呼叫。

## 延伸應用與學習資源

這個應用程式是一個很好的起點，您可以基於它進行許多擴展和改進：

### 延伸應用

*   **使用真實股票 API**：將模擬數據替換為實際的股票數據 API，例如 Alpha Vantage、Finnhub、Yahoo Finance API (注意：許多免費 API 有請求限制，可能需要註冊 API Key)。
*   **多股票追蹤**：增加一個輸入框，允許用戶輸入多個股票代號並同時顯示它們的價格。
*   **圖表顯示**：集成前端圖表庫（如 Chart.js、D3.js 或 ApexCharts），將歷史價格數據繪製成 K 線圖或其他圖表。
*   **WebSocket 實作**：如果需要真正的即時推播，而不僅僅是輪詢 (polling)，可以考慮使用 Django Channels 實作 WebSocket。這將允許伺服器在價格變動時主動將數據推播到客戶端，減少不必要的請求。
*   **用戶認證與個人化**：為用戶提供註冊登錄功能，允許他們保存自己關注的股票列表。
*   **錯誤處理與用戶體驗**：增加更健壯的錯誤處理機制，例如顯示 API 請求失敗訊息、加載狀態指示器等。

### 學習資源

*   **Django 官方文檔**：這是學習 Django 的最佳資源，內容詳盡且持續更新。
    *   [https://docs.djangoproject.com/](https://docs.djangoproject.com/)
*   **MDN Web Docs (JavaScript, Fetch API)**：學習前端技術的權威網站。
    *   [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript)
    *   [https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API)
*   **Django REST Framework 官方文檔**：如果您想構建更複雜的 RESTful API。
    *   [https://www.django-rest-framework.org/](https://www.django-rest-framework.org/)
*   **Django Channels 官方文檔**：如果您希望探索 WebSocket 和真正的即時通訊。
    *   [https://channels.readthedocs.io/en/latest/](https://channels.readthedocs.io/en/latest/)

希望這篇文章能幫助您成功建立一個即時股價顯示應用程式，並激發您對 Web 開發的更多興趣！
```