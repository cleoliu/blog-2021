---
title: 建立即時股市報價應用程式：使用 Python Flask 與 Alpha Vantage API
date: 2025-08-12 19:17:29 +0800
categories: [Python, Web Development, API, Financial Tech]
tags: [Python, Flask, API, Stock Market, Real-time, Frontend, JavaScript, HTML]
image: 
description: 本文將引導您使用 Python Flask 作為後端，整合 Alpha Vantage API 獲取即時股票數據，並透過簡單的 HTML/JavaScript 前端展示報價，一步步建立一個即時股市報價應用程式。
---


## 1. 導言

在數位時代，快速獲取即時資訊已成為常態，尤其在金融市場中，及時的股票報價對於投資決策至關重要。本教學文章將引導您從零開始，使用 Python 的 Flask 框架作為後端，並整合免費的 Alpha Vantage API 來獲取股票數據，最終透過一個簡單的網頁前端（HTML/JavaScript）來顯示即時股價。

透過本教學，您將學習到：
*   Python Flask 網頁開發基礎
*   如何安全地使用外部 API (Alpha Vantage)
*   前端與後端資料互動的基礎
*   實現網頁數據定時更新（模擬即時性）

讓我們一同踏上建立您第一個即時股市報價應用程式的旅程！

## 2. 前置需求

在開始實作之前，請確保您的開發環境已準備妥當。

*   **Python 3.8+**: 您可以從 [Python 官方網站](https://www.python.org/downloads/) 下載並安裝。
*   **pip**: Python 的套件管理工具，通常隨 Python 一同安裝。
*   **虛擬環境 (Virtual Environment)**: 推薦使用 `venv` 或 `conda` 管理專案依賴。
*   **Alpha Vantage API Key**: 本教學將使用 Alpha Vantage 提供的免費 API。請前往 [Alpha Vantage 官方網站](https://www.alphavantage.co/support/#api-key) 註冊並獲取您的 API Key。
*   **文字編輯器/IDE**: 例如 Visual Studio Code, Sublime Text 或 PyCharm。
*   **網頁瀏覽器**: 任何現代瀏覽器皆可，用於測試應用程式。

## 3. 實作步驟

本節將詳細說明建立即時股市報價應用程式的每個步驟。

### 步驟 1：建立專案與設定虛擬環境

首先，建立一個新的專案資料夾，並在其中設定虛擬環境以隔離專案依賴。

```bash
mkdir real-time-stock-app
cd real-time-stock-app

# 建立虛擬環境
python -m venv venv

# 啟用虛擬環境 (Windows)
.\venv\Scripts\activate

# 啟用虛擬環境 (macOS/Linux)
source venv/bin/activate
```

### 步驟 2：安裝所需 Python 套件

虛擬環境啟用後，安裝 Flask、Requests (用於 API 請求) 和 python-dotenv (用於安全管理 API Key)。

```bash
pip install Flask requests python-dotenv
```

### 步驟 3：設定 Alpha Vantage API Key

為了安全地管理您的 API Key，我們將使用 `.env` 檔案。在專案根目錄下建立一個名為 `.env` 的檔案，並填入您的 Alpha Vantage API Key：

```
# .env
ALPHA_VANTAGE_API_KEY=YOUR_ALPHA_VANTAGE_API_KEY
```

請將 `YOUR_ALPHA_VANTAGE_API_KEY` 替換為您從 Alpha Vantage 網站獲取到的實際 API Key。

### 步驟 4：建立 Flask 後端應用程式 (`app.py`)

建立一個名為 `app.py` 的檔案，這將是我們 Flask 應用程式的主要邏輯。

```python
# app.py
import os
import requests
from flask import Flask, render_template, jsonify, request
from dotenv import load_dotenv

# 加載 .env 檔案中的環境變數
load_dotenv()

app = Flask(__name__)

# 從環境變數獲取 API Key
ALPHA_VANTAGE_API_KEY = os.getenv("ALPHA_VANTAGE_API_KEY")
if not ALPHA_VANTAGE_API_KEY:
    raise ValueError("ALPHA_VANTAGE_API_KEY is not set in the .env file.")

# Alpha Vantage API 基礎 URL
ALPHA_VANTAGE_BASE_URL = "https://www.alphavantage.co/query"

# 首頁路由：渲染 HTML 模板
@app.route('/')
def index():
    return render_template('index.html')

# API 路由：獲取即時股票報價
@app.route('/api/stock')
def get_stock_quote():
    symbol = request.args.get('symbol', 'IBM').upper() # 預設為 IBM，並轉為大寫

    params = {
        "function": "GLOBAL_QUOTE",
        "symbol": symbol,
        "apikey": ALPHA_VANTAGE_API_KEY
    }

    try:
        response = requests.get(ALPHA_VANTAGE_BASE_URL, params=params)
        response.raise_for_status() # 檢查 HTTP 請求是否成功
        data = response.json()

        # 檢查 API 返回的數據結構
        if "Global Quote" in data and data["Global Quote"]:
            quote = data["Global Quote"]
            stock_info = {
                "symbol": quote.get("01. symbol", symbol),
                "open": quote.get("02. open"),
                "high": quote.get("03. high"),
                "low": quote.get("04. low"),
                "price": quote.get("05. price"),
                "volume": quote.get("06. volume"),
                "latest_trading_day": quote.get("07. latest trading day"),
                "previous_close": quote.get("08. previous close"),
                "change": quote.get("09. change"),
                "change_percent": quote.get("10. change percent")
            }
            return jsonify(stock_info)
        elif "Error Message" in data:
            return jsonify({"error": data["Error Message"]}), 400
        else:
            return jsonify({"error": "Failed to retrieve stock data or invalid symbol."}), 404

    except requests.exceptions.RequestException as e:
        return jsonify({"error": f"Network error or API request failed: {e}"}), 500
    except ValueError as e:
        return jsonify({"error": f"JSON decoding error: {e}"}), 500
    except Exception as e:
        return jsonify({"error": f"An unexpected error occurred: {e}"}), 500

if __name__ == '__main__':
    app.run(debug=True) # debug=True 會在代碼修改時自動重載應用程式
```

### 步驟 5：建立網頁前端 (`templates/index.html`)

在專案根目錄下建立一個名為 `templates` 的資料夾，並在其中建立 `index.html` 檔案。這個檔案將負責顯示我們的股價資訊。

```html
<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>即時股市報價</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #0056b3;
            text-align: center;
        }
        .input-group {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        .input-group input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .input-group button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        .input-group button:hover {
            background-color: #0056b3;
        }
        #stock-info {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        #stock-info p {
            margin: 8px 0;
            font-size: 1.1em;
        }
        #stock-info .label {
            font-weight: bold;
            color: #555;
            display: inline-block;
            width: 120px; /* 統一標籤寬度 */
        }
        .error {
            color: red;
            font-weight: bold;
            text-align: center;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>即時股市報價</h1>

        <div class="input-group">
            <input type="text" id="symbolInput" placeholder="輸入股票代碼 (e.g., IBM, MSFT)" value="IBM">
            <button onclick="fetchStockData()">查詢</button>
        </div>

        <div id="stock-info">
            <p class="loading">載入中...</p>
        </div>
    </div>

    <script>
        // 定義一個變數來儲存定時器，以便之後可以清除
        let intervalId;

        // 獲取股票數據的函數
        async function fetchStockData() {
            const symbol = document.getElementById('symbolInput').value.trim();
            const stockInfoDiv = document.getElementById('stock-info');
            
            if (!symbol) {
                stockInfoDiv.innerHTML = '<p class="error">請輸入有效的股票代碼！</p>';
                return;
            }

            stockInfoDiv.innerHTML = '<p class="loading">載入中...</p>'; // 顯示載入狀態

            try {
                const response = await fetch(`/api/stock?symbol=${symbol}`);
                const data = await response.json();

                if (response.ok) {
                    // 成功獲取數據，更新顯示
                    stockInfoDiv.innerHTML = `
                        <p><span class="label">股票代碼:</span> ${data.symbol}</p>
                        <p><span class="label">當前價格:</span> $${parseFloat(data.price).toFixed(2)}</p>
                        <p><span class="label">開盤價:</span> $${parseFloat(data.open).toFixed(2)}</p>
                        <p><span class="label">最高價:</span> $${parseFloat(data.high).toFixed(2)}</p>
                        <p><span class="label">最低價:</span> $${parseFloat(data.low).toFixed(2)}</p>
                        <p><span class="label">成交量:</span> ${parseInt(data.volume).toLocaleString()}</p>
                        <p><span class="label">變動:</span> ${parseFloat(data.change).toFixed(2)}</p>
                        <p><span class="label">變動百分比:</span> ${parseFloat(data.change_percent).toFixed(2)}</p>
                        <p><span class="label">最新交易日:</span> ${data.latest_trading_day}</p>
                    `;
                } else {
                    // 處理 API 返回的錯誤訊息
                    stockInfoDiv.innerHTML = `<p class="error">錯誤：${data.error || '無法獲取股票數據'}</p>`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                stockInfoDiv.innerHTML = `<p class="error">連線失敗或發生未知錯誤。</p>`;
            }
        }

        // 頁面加載完成後立即獲取一次數據
        document.addEventListener('DOMContentLoaded', () => {
            fetchStockData();
            // 每隔 15 秒更新一次數據 (Alpha Vantage 免費版限制每分鐘 5 次請求)
            // 請根據您的 API 方案調整頻率
            intervalId = setInterval(fetchStockData, 15000); 
        });

        // 當用戶手動點擊查詢時，清除舊的定時器並啟動新的定時器
        // 確保定時器是針對當前查詢的股票代碼
        document.getElementById('symbolInput').addEventListener('change', () => {
            if (intervalId) {
                clearInterval(intervalId); // 清除舊的定時器
            }
            // 重新啟動定時器，查詢新的股票代碼
            intervalId = setInterval(fetchStockData, 15000);
        });

        // 為了避免重複啟動定時器，當用戶點擊查詢按鈕時，也應該清除並重新設定定時器
        document.querySelector('.input-group button').addEventListener('click', () => {
            if (intervalId) {
                clearInterval(intervalId);
            }
            intervalId = setInterval(fetchStockData, 15000);
        });
    </script>
</body>
</html>
```

### 步驟 6：運行應用程式

現在，您可以在終端機中運行您的 Flask 應用程式了。

```bash
# 確保您仍在 real-time-stock-app 資料夾中且虛擬環境已啟用
flask run
```

當應用程式啟動後，您將看到類似以下的輸出：

```
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: ...
```

在您的網頁瀏覽器中打開 `http://127.0.0.1:5000`，您應該就能看到即時股市報價應用程式的介面了。輸入股票代碼（例如 `GOOG`, `AAPL`, `TSLA`）並點擊「查詢」，即可看到對應的股價資訊，並且每隔 15 秒會自動更新一次。

## 4. 常見錯誤與解法

在開發過程中，您可能會遇到一些問題。以下是一些常見錯誤及其解決方法：

### 錯誤 1：`ALPHA_VANTAGE_API_KEY is not set in the .env file.`

*   **原因**: `app.py` 無法從 `.env` 檔案中讀取到 `ALPHA_VANTAGE_API_KEY`。
*   **解法**:
    *   確認您在專案根目錄下建立了 `.env` 檔案。
    *   確認 `.env` 檔案中的變數名稱是 `ALPHA_VANTAGE_API_KEY`，並且沒有拼寫錯誤。
    *   確認 `dotenv` 套件已正確安裝 (`pip install python-dotenv`)。
    *   確認您的 API Key 已正確填寫，沒有多餘的空格或特殊字元。

### 錯誤 2：API 請求失敗或返回錯誤訊息 (e.g., `Invalid API call`, `Thank you for using Alpha Vantage!`)

*   **原因**:
    *   API Key 無效或有誤。
    *   超出 Alpha Vantage 免費方案的請求限制 (每分鐘 5 次請求，每天 500 次請求)。
    *   股票代碼無效。
    *   網路連線問題。
*   **解法**:
    *   **檢查 API Key**: 登錄 Alpha Vantage 網站，確認您的 API Key 有效。
    *   **檢查請求限制**: 如果您頻繁刷新頁面，可能會很快達到免費方案的限制。請耐心等待一段時間再試，或考慮升級 API 方案。在教學中，我們將 `setInterval` 設置為 15 秒 (即每分鐘 4 次請求)，這在免費方案限制內。
    *   **檢查股票代碼**: 確保您輸入的是正確且存在的股票代碼（例如 NASDAQ, NYSE 等主要交易所的代碼）。
    *   **檢查網路**: 確保您的設備有穩定的網路連線。

### 錯誤 3：網頁顯示 "Loading..." 或沒有數據更新

*   **原因**:
    *   JavaScript 程式碼有錯誤，導致 `fetchStockData()` 沒有被執行或執行失敗。
    *   後端 Flask 應用程式沒有運行。
    *   瀏覽器快取問題。
*   **解法**:
    *   **檢查 Flask 狀態**: 確保在終端機中 `flask run` 命令正在運行，並且沒有錯誤輸出。
    *   **打開瀏覽器開發者工具**: 按 F12 (或右鍵點擊 -> 檢查) 打開瀏覽器的開發者工具。
        *   在 `Console` (控制台) 選項卡中檢查是否有 JavaScript 錯誤。
        *   在 `Network` (網路) 選項卡中檢查 `/api/stock` 請求的狀態和響應，看是否成功返回數據。
    *   **清除快取**: 嘗試清除瀏覽器快取或使用無痕模式打開頁面。

### 錯誤 4：`pip` 或 `python` 命令找不到

*   **原因**: Python 環境變數未設置或未正確安裝。
*   **解法**:
    *   確保 Python 已正確安裝，並在安裝時勾選了「Add Python to PATH」選項。
    *   如果您有多個 Python 版本，請確保使用的是正確的版本（例如 `python3` 或 `py` 而不是 `python`）。
    *   如果使用虛擬環境，請確認虛擬環境已成功啟用。

## 5. 延伸應用與學習資源

恭喜您！您已經成功建立了一個即時股市報價應用程式。這只是一個開始，您可以基於此基礎進行更多有趣和實用的擴展：

### 延伸應用

*   **更多股票資訊**: Alpha Vantage API 提供了豐富的數據，例如歷史K線圖、財務報表、技術指標等。您可以探索其 [API 文件](https://www.alphavantage.co/documentation/) 並將更多數據整合到應用程式中。
*   **圖表展示**: 使用前端 JavaScript 圖表庫（如 [Chart.js](https://www.chartjs.org/) 或 [ApexCharts](https://apexcharts.com/)）來繪製股票價格趨勢圖，讓數據更具視覺化。
*   **用戶介面優化**: 使用更專業的 CSS 框架（如 [Bootstrap](https://getbootstrap.com/) 或 [Tailwind CSS](https://tailwindcss.com/)）來美化您的應用程式介面，提供更好的用戶體驗。
*   **多支股票追蹤**: 允許用戶輸入多個股票代碼，並在一個頁面顯示它們的即時報價，甚至保存用戶的自選股清單。
*   **預警通知**: 整合即時通訊技術（如 WebSockets 或 Server-Sent Events）來實現真正的「推送」式即時更新，並在股價達到預設門檻時發送通知。
*   **數據持久化**: 將股票數據儲存到資料庫中（如 SQLite, PostgreSQL），以便進行歷史數據分析或離線查詢。
*   **部署應用程式**: 將您的 Flask 應用程式部署到雲端平台（如 [Heroku](https://www.heroku.com/), [AWS Elastic Beanstalk](https://aws.amazon.com/elastic-beanstalk/), [Google Cloud Run](https://cloud.google.com/run/)），使其可以在公共網絡上訪問。

### 學習資源

*   **Flask 官方文檔**: [https://flask.palletsprojects.com/](https://flask.palletsprojects.com/) - 學習更多關於 Flask 的路由、模板、請求處理等功能。
*   **Alpha Vantage API 文檔**: [https://www.alphavantage.co/documentation/](https://www.alphavantage.co/documentation/) - 了解所有可用的金融數據 API 及其使用方法。
*   **MDN Web Docs (JavaScript)**: [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript) - 學習 JavaScript 的基礎知識，包括 `fetch` API 和 `setInterval`。
*   **Python Requests 文檔**: [https://docs.python-requests.org/](https://docs.python-requests.org/) - 了解如何使用 Python 進行 HTTP 請求。
*   **EnvD：環境變數管理**: [https://pypi.org/project/python-dotenv/](https://pypi.org/project/python-dotenv/) - 學習如何安全地處理敏感資訊。

希望這篇文章能幫助您邁出建立即時應用程式的第一步！祝您編碼愉快！
